# Security Policy

## Source Verification and Distribution

This Homebrew tap uses a transparent mirroring architecture to provide stable SHA256 checksums while maintaining clear upstream attribution.

### Trust Model

This tap is a **downstream distribution** of the official [Alacritty terminal emulator](https://github.com/alacritty/alacritty). Security relies on:

1. **Upstream Alacritty**: The official project maintained by the Alacritty team
2. **Transparent Mirroring**: This tap mirrors upstream sources with documented verification
3. **Patch Transparency**: All modifications are visible in `alacritty-dock-menu.patch`
4. **Automated Verification**: GitHub Actions enforce consistency checks

### Source Distribution Architecture

#### How It Works

```
Upstream Source (Alacritty GitHub)
          ↓
    Download tarball
          ↓
  Calculate SHA256 (pre-upload)
          ↓
Upload to GitHub Release Assets (immutable)
          ↓
  Formula references asset URL
          ↓
Users install with SHA256 verification
```

#### Why Release Assets?

GitHub's auto-generated source archives can be regenerated with different SHA256 hashes even for the same version tag. This causes Homebrew installations to fail when checksums don't match.

By mirroring upstream tarballs as **GitHub Release Assets**:

- SHA256 becomes permanently stable (GitHub guarantees immutability)
- Users can verify sources independently
- Clear audit trail with upstream attribution

### Verification Steps

#### For Users: Verify Before Installation

**1. Check the release page:**

Visit: <https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched/releases>

Each release documents:

- Upstream Alacritty version and release URL
- SHA256 checksum
- Build validation results
- Patch compatibility status

**2. Verify the SHA256 checksum:**

```bash
# Download the release asset
curl -sL "https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched/releases/download/v0.16.1/alacritty-v0.16.1.tar.gz" | shasum -a 256

# Compare with the SHA256 in the release notes
# Expected: b7240df4a52c004470977237a276185fc97395d59319480d67cad3c4347f395e
```

**3. Verify upstream attribution:**

Check that the release notes link to the official Alacritty release:

```bash
# Example for v0.16.1
# Upstream: https://github.com/alacritty/alacritty/releases/tag/v0.16.1
```

**4. Review the patch:**

```bash
# Clone this repository
git clone https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched.git
cd homebrew-alacritty-macos-dock-patched

# Review the patch file
cat alacritty-dock-menu.patch
```

The patch only adds macOS dock menu functionality and does not modify security-sensitive code paths.

#### For Advanced Users: Full Source Audit

**1. Download both upstream and mirrored tarballs:**

```bash
VERSION="0.16.1"

# Download from this tap's release assets
curl -sL "https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched/releases/download/v${VERSION}/alacritty-v${VERSION}.tar.gz" -o tap-source.tar.gz

# Download from upstream Alacritty (if still available)
curl -sL "https://github.com/alacritty/alacritty/archive/refs/tags/v${VERSION}.tar.gz" -o upstream-source.tar.gz
```

**2. Compare checksums:**

```bash
shasum -a 256 tap-source.tar.gz
shasum -a 256 upstream-source.tar.gz
```

**Note**: Upstream tarballs may have been regenerated by GitHub, so checksums might differ. This is the exact problem the release asset approach solves.

**3. Extract and compare contents:**

```bash
mkdir tap-source upstream-source
tar -xzf tap-source.tar.gz -C tap-source
tar -xzf upstream-source.tar.gz -C upstream-source

# Compare directory trees
diff -rq tap-source/ upstream-source/
```

**4. Verify the patch applies cleanly:**

```bash
cd upstream-source/alacritty-${VERSION}
patch --dry-run -p1 < ../../alacritty-dock-menu.patch
```

### Security Properties

#### Defense-in-Depth Verification

1. **Source Verification**: Automation downloads from official Alacritty GitHub
2. **Mirror Integrity**: SHA256 calculated before uploading to release assets
3. **Immutability**: GitHub guarantees release assets never change
4. **User Verification**: Homebrew verifies SHA256 on every install
5. **Audit Trail**: Every release documents source, checksum, and build validation

#### What This Tap Does NOT Do

- **Does NOT modify upstream Alacritty source** (beyond the documented patch)
- **Does NOT compile custom binaries** (users build from source using `make app`)
- **Does NOT introduce dependencies** (only adds macOS dock menu functionality)
- **Does NOT touch security-sensitive code** (patch is isolated to UI layer)

### Patch Security

The `alacritty-dock-menu.patch` file adds approximately 156 lines of Objective-C runtime code to implement macOS dock menu functionality.

**Modified files:**

- `alacritty/Cargo.toml` - Adds `objc`, `cocoa` dependencies (standard macOS frameworks)
- `alacritty/src/macos/mod.rs` - Implements `applicationDockMenu:` delegate (~120 lines)
- `alacritty/src/main.rs` - Calls `setup_dock_menu()` on startup (~5 lines)

**Security considerations:**

- Uses only official macOS APIs (`NSMenu`, `NSMenuItem`, `NSApp`)
- Does not access network, filesystem, or system resources
- No new dependencies beyond standard macOS frameworks
- Code is isolated to dock menu functionality only

### Automated Build Verification

Every release is validated by GitHub Actions workflows:

**Build validation includes:**

- Patch applies cleanly (`patch -p1 --dry-run`)
- Compiles successfully (`make app`)
- Binary executes without errors
- Version matches expected release
- Dock menu implementation is present in binary

See workflow files in `.github/workflows/` for implementation details.

### Reporting Security Issues

If you discover a security vulnerability in:

**The dock menu patch:**

- Open an issue at: <https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched/issues>
- Label: `security`

**Upstream Alacritty:**

- Report to the official Alacritty project: <https://github.com/alacritty/alacritty/security>

**This tap's automation/distribution:**

- Open an issue at: <https://github.com/NorfeldtKnowit/homebrew-alacritty-macos-dock-patched/issues>
- Label: `security`, `automation`

### License and Legal

This tap follows Alacritty's Apache 2.0 license. The patch is a derivative work of Alacritty and is distributed under the same license.

**Upstream License**: <https://github.com/alacritty/alacritty/blob/master/LICENSE-APACHE>

All modifications are documented and publicly available in the patch file.

### Frequently Asked Questions

#### Why mirror upstream sources?

GitHub's auto-generated tarballs are non-deterministic. Mirroring as release assets provides permanent SHA256 stability while maintaining transparency.

#### How do I know the tarball hasn't been modified?

1. Every release documents the upstream Alacritty version with a direct link
2. The SHA256 is calculated before upload and verified on download
3. You can manually compare with upstream sources (see verification steps above)
4. The patch file shows all modifications transparently

#### What if GitHub regenerates the upstream tarball?

This is the exact problem we solve. Release assets are immutable - once uploaded, the SHA256 never changes.

#### Can I trust the automated workflows?

All workflows are open source in `.github/workflows/`. You can review:

- What they download (official Alacritty GitHub)
- What they calculate (SHA256 checksums)
- What they upload (release assets with documentation)
- What they modify (only the formula file)

#### How is this different from downloading directly from Alacritty?

Users still build from the same Alacritty source code. This tap:

1. Mirrors the source with stable checksums
2. Applies the documented patch for dock menu functionality
3. Provides Homebrew formula for easy installation

The build process (`make app`) is identical to building Alacritty manually.
